cisco packet tracer 7.11

Широковещательный MAC 
FFFFFFFF
Мультикастовый MAC
01-80-C2-00-00-08

MAC-таблица (cisco CAM table) - кто за каким портом сидит
Первоначально свич рассылает ARP запрос на все порты. 
Размер таблицы 1000 записей. При переполнении начинает флудить

SwitchL3 - может работать с ip адресами


Сisco основы cli
Enter - листать вывод
стрелка вниз - отменить вывод



? - справка по командам (также смотрим pdf "комманды cisco")
exit - выход
enable (en) - режим просмотра в привилегированом режиме.

show 
do show - из конфиг режима просмотр
	version
	interface fa0/8 - инфо по интерфейсу
	mac-addres-table - таблица c мас-адресами

configure terminal (conf ter)  - режим конфигурирования, заходить из en-режима
	hostname our_name - поменяем имя тачки
	interface fa0/8 - заходим в конфигурирование интерфейса
		duplex - устанавливаем режим дуплекса на интерфейсе
		speed - устанавливаем скорость порта



copy running-config startup-config (write) - сохранение конфига


stp - протокол построение дерева иерархии оборудования и избежания коллизий
dtp - динамический протокол транкинга cisco нужен для объединения линий в vlan
нескольких коммутаторов
cdp - протокол обнаружения оборудования cisco

____________________________________________
Все интерфейсы на свиче по умолчанию включены, на роутере по умолчанию
выключены.


Mеняем ip адрес на интерфейсе
en
conf ter
interface fa0/1
ip address 11.12.13.1 255.255.255.0
no shutdown - включаем интерфейс (no - противоположность)

show ip interface - просмотр c точки зрения ip-сети
show ip interface brief - коротко

arp proxy - позволяет отвечать на arp-запросы из других сегментов сети

________________________________________
IP адресация

частные и публичные адреса

24 - 16 - количество бит в маске

Маска подсети делит адрес на адрес сети и адрес компьютера
маска подсети решает будет ли arp запрос для dest-компьютера или arp на
прокси.
маска подсети работает только на уровне маршрутизации, и при передаче пакетов
не играет роли


Используем ipcalc тулзу

11111111 11111111 11111111 11111111 - итого 32 символа

адрес сети 192.168.1.0
начальный адрес 192.168.1.1
конечный адрес 192.168.1.254
броадкаст 192.168.1.255
итого 254 хоста

сокращение ip адреса 192.168.1 - 192.168.0.1


Классовые сети 
X - адрес сети/ x - адрес хоста - (16.777.214 хостов)
a класс первый бит = /8
0XXXXXXX xxxxxxxx xxxxxxxx xxxxxxxx
b класс два бита = /16 (65.535)
10XXXXXX XXXXXXXX xxxxxxxx xxxxxxxx
c класс три бита = /24 (254 хоста)
110XXXXX XXXXXXXX XXXXXXXX xxxxxxxx


_______________________________

IP которые нельзя использовать
127.0.0 - 127.255.255.255 (loopback)
оканчивающие 
0
255
0.0.0.0 пустой ip для нужды dhcp
169.254.0.0 - 169.254.255.255 - IPIPA
мультикаст адреса 224.0.0.0 - 247


________________________________________


Структура ethernet-кадра

Преамбула (7байт) | SFD (1байт) | DMAC (6 байт)| SMAC (6 байт)| Длина\тип (2
байта) | Данные (0-15000Байт)| Заполняющие байты (до 64 байт) | Контрольные
данные


SFD - указывают на начало полезной информации
Заполняющие данные - данные необходимые для формирования пакет

--------------------------

Структура IP пакета (14 полей перекрывающихся)

Версия протокола | Время жизни и служ информация о пакете | Протокол |  SIP |
DIP

--------------------------

Структура TCP пакета

Порт источника (2байта) | Порт назначения (2байта)| SN | ACK SN | Флаги|
Размер окна| Контрольная сумма | Указатель важности | 

SN - порядковый номер
ACK SN - указывает на успешное получение предыдущего пакета
Установка соединения:
SYN - хочу установить соединение, произвольный свой порт и произвольное число
в данных
SYN+ACK - в данных то число+1
ACK

---------
ip route ip mask dest - задать маршрут
show ip route - просмотр таблицы
do show ip route - запуск команды просмотра из конфиг режима

Отключить блокирование терминала
line console 0
exec-timeout 0 0 

_____________________

Динамическая маршрутизация

Дистанционно-векторные протоколы (RIPv2, EIGRP)
Протоколы состояния каналов связи (OSPF, IS-IS)
Протоколы выбора маршрута по пути (BGP)

igp - внутренний протокол маршрутизации
ospf
rip
eigrp
is-is level 1-2

egp - внешний протокол маршрутизации
bgp
egp
idrp
is-is level 3




ospf/bgp - основные протоколы



no ip route - удалить маршрут 

---- EIGRP - протокол разработанный компанией cisco 
router eigrp 1 - создаем подсеть
network 192.168.1.0 0.0.0.255 - поделиться сетями (внешние тоже прописать)
show ip eigrp neig - посмотреть установленные источники
show ip eigrp topology - просмотр доступных сетей с основными маршрутами

EIGRP имеют адрес назначения в пакетах 224.0.0.10.
Вложенные данные в ip пакет на нижних служебных уровнях

Слияние сетей по маске - нужно для быстрой обработки маршрута

network 0.0.0.0 255.255.255.255 - поделиться всеми маршрутами

passive interface fa0/0 - не делиться маршрутами
passive interface default - политика по умолчанию

no auto-summury - обязательная команда отключает классы в сетях (для старых
роутеров)

show ip protocols - информация по запущенных протоколах маршрутизации
show ip eigrp traffic - количество отправленных hello пакетов и принятых


Выбор источника и время анонсирования

debug eigrp packets  - аналог снифера просмотр пакетов по протоколу


no ip address - снять ip интерфейс с порта


Топология ====> Маршрутизация

Метрика и ее подсчет. Маршрут строиться на основе метода
Время на участках + время на портах + надежность (опционально и рисково)

Частое переключение маршрутов не есть хорошо

Succesor & visible succesor - основной и дополнительный маршрут

show ip eigrp topology all-links - все возможные маршруты


eigrp дает возможность балансировки между маршрутами даже в случае их
неравнозначности 
variance 6 между маршрутами отличающимися в 6 раз
variance 1 - отключить балансировку


Петли маршрутизации
разблокировать правило и включить переключения на общие маршруты
no ip split horisont

query - запросы о доступности подсети в случае обрыва
reply - ответ
sia-query - повтроный запрос в случае потери ответа
sia -reply

ip eigrp 1 stub - расказывать только о подключенных непосредственно сетях


Cуммаризация маршрутов или объединение подсетей 
interface fa7/0
ip summaty-addres eigrp 1 192.168.0.0 255.255.0.0

NBMA - бесклассовые сети не имеющие мультикаста
над одно интерфесе поднимаются несколько ip соединений

Аутентификация eigrp - для защиты от подлогов
ip authentification key-chain eigrp 


show clock - посмотреть время
clock set 15:50:33 14 nov 17
Устанавливаем ключ 
и его время действия

show running-config  - просмотр запущенной конфигурации
show startup-config - запущенная конфиграция


_____________________________________________________

Виды протоколов

Дистанционно-векторные протоколы (distanse vector protocol)
Роутеры не знают как устроенна сеть,  ориентируются на метрики и таблицы
маршрутизации
Протокол состояния каналов связи  (Link State Protocol)
Роутеры знают устройство сеит

OSPF - собирается информация со всех устройств и затем строится дерево
маршрутизации
EGRP - пересылаются данные об узлах и напрвлениях
 
_________________

BGP -
полная таблица интернета маршрутизации -  512тыс записей
ориентирован на работу в небезопасной сети



VLAN
метка vlan на пакете
все это делается на портах
switchport mode access 
switchport acces vlan1 - указываем vlan

show vlan - посмотреть таблицу
switchport trunck encapsulation dot1q - для поднятия транка на интерфейсе
switchport mod trunck

Отключить доступ к режиму транка

int fa0/3.2 - создание субитнерфейса
encapsulation dot1q - создание субинтерфейса
для объединения 

маршрутизатор 3 уровня и роутер
свитч второго уровня может использоваться для простой марштрутизации
первый заточен для работы во внутренней сети и не предназначен для работы с
разными сетями.

native vlan - vlan присваемый по умолчанию
на нем нет никаких меток о влане

атака с подменой vlan

intarface range - задать правило для диапазона интерфейсов

vtp - протокол для vlan автоматизации

номер ревизии для синхронизации базы vlan

vtp - пароль, легко подхватывается и поменяется

__________________

access list - 
acl list standart & extended
extended - позволяет задавать ip адреса назначения, протоколы 

access-list 20 deny 192.168.0.1 0.0.255.255
ip access-group 20 in/up - добавляем список 20 на вход|выход определенного
интерфейса
Включаем аксес-лист задается полика отключения всего для этого
acces-group 20 permit up ip/mask
 - - permit any - разрешить все
no access-list 20 - удалить лист
dany tcp/udp/icmp
eq 80 - порт
составление правил от частного к общему
host - удаленный хост

Аксес листы могут вешаться на интерфейсы либо на устройство в целом

PACL - работает только на вход на свиче

mac access list есть также на свичах
порты и vlan access listы

____________________

Два уровня свичей объединяются с роутером, присутствует избыточность. Для
решения проблем с ней используется stp

stp - может помочь при соединении портов коммутатора

при использовании cвича на другом конце свича в случае использования розеток,
мы теряем возможность использования vlan

Отказоустойчивая технология, но трафик ходит не правильно

1) выбор корня
3) выбор порта

32768 - приоритет по умолчанию
mac адресс определеяет выбор рут коммутатора

show spaning-tree
spaning-tree vlan1 root prymary
Настройка приоритетности может занять большое время

cisco своя реализация stp
dbdu guard - заблокировать stp

stp отвечают за vlan

root коммутатор для каждого vlan
стоимость пути в stp
функционал очень сильно зависит о версии протокола stp

____________________________
FHRP
два роутера с разными ip перекидываются одним виртуальным ip который
обеспечивает доступ к сети

HSRP - cisco
VRRP - свободный на основе HSRP
GLBP - cisco с сложный с балансировкой
carp - openbsd


standby 1 ip 192.168.1.1 - задать виртуалку для роутера

режимы 
forwarding
standby

show stanby - посмотреть режим роутера
назначается виртуальный mac адрес
роутеры посылают hello пакеты раз в 3 секунды в случаее смерти роутер
похдватывает ip, mack
Задать пароль для защиты данной технологии

На мультилаерных свичах может крутиться FHRP

Vlan могут быть завернуты fhrp в каждом свой ip-адреса и маршр
На каждом vlan свой ip
Разделение роутеров для vlan в случаее проблем трафик будет завернут на живой

vrrp для cisco и другого вендора
нет режима stendby для дополнительного роутера в следствии чего, при
неисправности будет происходить подсчет для нового роутера

использовать реальный ip для виртуального режима

Переключение в случаее доступа к сети, обеспечивается за счет значения метрики
или линка для маршрута

____________________________________

etherchanel - два физических интефейса в один

 -----
 router
 root switch
 distribution switch
 access switch
 ------

stackwise технология объединения нескольких свечей в один
vsl (vss) - дорогое решение от cisco

модульность оборудования cisco
несколько БП, плат управления, и плат коммутации

flexlinks - позволяет указать статически переключение интерфейсов в случае
падения основного

______________________________________

NAT

вешаем на интерфейс
ip nat outside
ip nat inside
ip nat inside source static ip iprouter

show ip nat translation - просмотр таблицы нат (порты, ip соответствие)
show ip nat statiscics

Статистическа и динамическая трансляция кому разрешить, и какой адрес выбрать

Перегруженный нат (PAT,NAPT,NAT Overload) - один публичный адрес для пула

Проброс порта
ip nat inside port ip

_______________________________________

DHCP

Создаем пул адресов

DHCP DISCOVER - запрос на ip (broadcast)
DHCP OFFER - ответ на ip адрес
DHCP REQUEST - принятие клиентом адреса (broadcast)
DHCP ACK - подтверждение выдачи

Перед выдачей ip сервер проверяет наличие такого ip в сети спомощью arp
хост проверяет ip после получение его arp запросом

Аренда продлевается через половину срока использования

udp - пакеты
исходящие 67 и назначения 68 порты
id, hops, type
клиент вписывает 00000 в ip

ipconfig /release
ipconfig /renew - обновить адрес в винде

ip dhcp - работает на cisco роутерах
ip dhcp conflict - таблица конфликтов на роутере

DHCP RELEASE - освобождение ip
DHCP DECLINE - отказ от ip
DHCP ANCK - освобождение от сервера
DHCP INFORM - узнать дополнительные опции подключения

Отдельные пулы для vlan
dhcp dexclude-adress - исключить адрес из пула

указываем маршруты, днс
имя загрузочного образа и куча всяких других настроек

wins - dns для netbios

Привязка к mac

dhcp relay - позволяет пересылать dhcp в другую сеть

______________________________________-

Custom Ports

скорость до 2 мбт
v.35 x.21 TIA-232
SMART SERIAL 

DCE - ведущее устройство
DTE - ведумое

clock rate 4000000 - скорость интерфейса
bandwith 400000- на циско скорость

int ser1/0
ip addresss ip mask
ip route

HDLС - протокол канального уровня

incapsulation ppp - включить ppp на ser1/0

ppp 
LCP - согласование протоколов
аутентификация 
сжатие данных 
мту, мру - максимум приема
защита от петель

LCP - согласование сетевого уровня 

PAP - аутентификация, может быть двухсторонняя. Данные в открытом виде
CHAP - шифрует данные аутентификации
MCHAP
Случайное число + плюс пароль = Хэш 
который затем считается на машине 


PPPoE - ppp поверх ethernet


_____________________

IPSla - пингуем сервис. Если пинга нет то переключаемся на другой
маршрутизатор

ping 8.8.8.8 source fa0/1 - указываем из-под какого интерфейса пинговать

Несколько провайдеров при одном роутере поднимаем ip sla
правило nat трансляции для этого проиходит через функцию match

Провайдера независимые интернет адреса RIR реализаутся за счет анонсирования
BGP

_________________________

Защита 

port security защита от переполнения mac-таблица
unicast становится broadcast

Задаем количество мас адресов для порта

switch port-sectyrity max 3

shutdown - порт

Технология 802.1x - позволяет организовать аутентификацию в сети с помощью
пароля.

Защита от шторма - блокировка порта в случае бродкастового трафика в
зависимости от уровня загрузки

shtorm-control

На маршрутизации нет канального шторма. 

DHCP - атака на службу

dhcp snoping - вешаем защиту на порты

ARP-spofing

apr inspection - на основе mac таблицы на свиче и службы dhcp, и рука
привязываем маки и ip

Подключаем данную службы только на acces свичах

____________________________

Poe - power over ethernet

для телефона и точек доступа, камеры

специальный свич

до 60 W ват

poe включается только в случае ответа устройства на посылаемый сигнал.

power injerctor - переносной блок 

сброс по питанию можно сделать с помощью команды

--
CDP - протокол
протокол о соседстве устройст

show cdp neig - покажет информацию о соседних устройствах

--
Ускорение маршрутизации 

просчет на основе ЦП
служебная таблица с индексацией маршрутов

---
pbr - позволяет маршрутизировать трафик на основе узлов источника и назначения

_________________________________


CISCO

running & startup config

copy - команда для копирования конфига
configure replace running config - слияние конфигов или замена

Плановый бэкап конфига

 Загрузка
 
 Post служба вшытая в ПЗУ, далее bootstrap служба находится тамже зачем ищится
 образи ios затем конфиг

 usernama nanme password dadfas 
 востановление пароля через сервисный режим ramon
 при этом конфигурации мы не потеряем конфигурацию. Если не происходило
 смещение в памяти

 В режим ramon можно попасть по отключению и залипанию кнопки питания

 пароль на консоль и на изменение привелегий

 множественные прошивки которые переключаются командой boot
 Можно будет удалить образа
 Можно загрузить образ через ramon

 radios - сервер позволяет организоывать централизованное хранение данныхй и
 доступ к устройствам

 Привязать vlan с active directory

IDS/IPS - службы для анализа безопасности


Трехуровневая модель сети
- Уровень доступа (Acess Layer) - подключение пользователей собирается на свичах
- Уровень  распределения (Distribution Layer) - агрегация, маршрутизация среди  пользователей - роутеры, L3 свичи
- Уровень кор (Core Layer) - резервирует каналы, объединяет все уровни
  распределения и обеспечивает доступ к
  серверам компании и сервисам.
