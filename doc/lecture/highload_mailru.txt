HIGHLOAD курс от mail.ru 2017 год начало
https://www.youtube.com/playlist?list=PLrCZzMib1e9rZohs_FJg8MK52Ey494z40

Признаки высоких нагрузок:
Утилизация оборудования 50-70%
Запросы от 1000 в секунду


2. Лекция
Толстые клиенты
Пуш-запрос - данные посылаются с сервера на клиент
Хорошая автономность, экономия трафиков и ресурсов сервера
Плохое обновление

Тонкий клиент - браузер
Те же приемущества и недостатки

Проблемы с ресурсами:
Память;
Процессор;
Диск;
Сеть.

Среднее количество памяти: 128Gb

Неэфективный алгоритм жрет cpu:
часто обращается в память
находится в блокировке
нет многопоточности

Диски
Доступ к диску 10мс
ЦПУ ждет обращение к диску
Чтение с hdd 90Mб, ssd 500мб - чтение последовательности
Запись hdd 90мбб ssd 140мб - запись последовательности
Чтение блоков по 4к hdd: 0,68 мб, ssd 63 мб/c
запись 4кбит блоков: hdd 0,36, sdd 19 мб/c

Если блоки расположенны в разных местах до тратиться 10мс

Сеть
Скорость в дата-центре 1mc (в 10 раз быстрее диска, слова автора)


Оптимизация:
процессор/память - больше памяти меньше процессора
		   сожмем данные на будем использовать цпу
Память/диск -  кэш/cвап
Процессор/диск - сжимаем данные

Пропускная способность/задержка - записываем пачкой или мгновенное обновление

Вертикальное масштабирование:
Нужна вместительнее база - купил больше дисков
Нужна производительнее программа - купил мощнее цп
Небольшие вложения, существует предел

Горизонтальное масштабирование:
Размазать по нескольким дешевым серверам
Тяжело масштабируются сервисы с состояниями (базы) statefull
Разделение по слоям (сервер вэб, сервер логики)
Разделение по функциям (сервер сообщений, сервер аутетификации, бд сообщенй)

Избыточность за счет дополнительного оборудования, 
информации для восстановления, 
избыточность действий сложность алгоритма


ACID (атомарнось,консистентность,)
Оптимизация базы данных:
Индексация
Короткие транзакции - блокировки
Денормализация - избыточность данных в таблицах
Минимум логики - отсутвие вычислений на cpu
  
CAP - теорема
Consistency - согласованность данных
Аvailability - доступность
Partion tolerance - устойчивость к разделению

Две вещи из трех,
Либо отказоустойчивостью либо консистентность

Мастер - слейв 
Слейв на чтение

Мастер - Мастер
Кворум мастеров на casandra

Оптимистичная блокировка

Удаление происходит с помощью метки,
Алгоритм физического удаления 

Кэш для отдачи данных из БД
Холодный старт - сохранять состояние кэша


Очереди
Масштабируемость
Низкое время обработки запроса
Эластичность
Отказоустойчивость

Хранение - память, диск, распределенные

Микросервисы
Быстрее отлаживать
Изоляция отказов

Падает производительность, сериализация для сети
Сложность отладки, сложность разработки
Сложность сбора логов, конфигурирования

