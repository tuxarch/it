zpool list - список пулов
zpool status -v - инфо по пулу


Создать пул:
zpool create -f -o ashift=13 -O atime=off -O dedup=off -O compression=lz4 tank mirror /dev/sda1 /dev/sdb2

Уничтожить пул:
zpool destroy myzfs

Отключить диск от пула:
zpool detach myzfs /disk3

Подключить диск к пулу:
pool attach myzfs /disk1 /disk3

Отключить/включить диск
zpool offline myzfs /disk1
zpool online myzfs /disk1

Заменить один диск другим:
zpool replace myzfs /disk1 /disk3

Восстановление рейда:
zpool scrub myzfs

Комперссию посмотреть:
zfs get compression
zfs get compressratio - степень сжатия
zfs set compression=lz4 rpool - включить компрессию на разделе

Посмотреть точки монтирования:
zfs get mountpoint

Отмонтировать/примонтировать:
zfs unmount (-f) tank/home/eschrock - force
zfs set mountpoint=/foo_mount tank

Обновить:
zfs upgrade


Снапшоты:
zfs list -t snapshot - список снапшотов
zfs snapshot rpool/db/store@snap_name - создать снапшот
zfs rollback rpool/db/store@pre-rm - восстановить из снапшота


_________________________________________________________________________

autoexpand=on - позволяет монтировать диски большего размера
compression=gzip-9 - максимальная комперссия



_________________________________________________________________________

Статистика:
zpool iostat 5

Посмотреть компрессию:
zfs list -o compression

История:
zpool history


_________________________________________________________________________

Преимущества zfs:
Всегда консистентное состояние из-за cow
Все блоки с чексуммой
Компрессия, снапшоты
Накопление изменение в памяти и запись ее на диск


Создать свап раздел:

zfs create -V 8G -b $(getconf PAGESIZE)  -o logbias=throughput -o sync=always -o primarycache=metadata -o com.sun:auto-snapshot=false <pool>/swap
mkswap -f /dev/zvol/<pool>/swap
swapon /dev/zvol/<pool>/swap

Лимит на использование памяти:
arc_summary
cat /proc/spl/kstat/zfs/arcstats


echo "options zfs zfs_arc_max=4294967296" | tee -a /etc/modprobe.d/zfs.conf
